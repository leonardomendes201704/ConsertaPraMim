@using System.Globalization
@model ConsertaPraMim.Application.DTOs.PaymentReceiptDto
@{
    ViewData["Title"] = "Comprovante de Pagamento";
    var ptBr = new CultureInfo("pt-BR");

    string StatusLabel(string status) => status switch
    {
        "Pending" => "Pendente",
        "Paid" => "Pago",
        "Failed" => "Falhou",
        "Refunded" => "Estornado",
        _ => status
    };

    string MethodLabel(string method) => method switch
    {
        "Pix" => "PIX",
        "Card" => "Cartao",
        _ => method
    };
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
        <a asp-action="Details" asp-route-id="@Model.ServiceRequestId" class="btn btn-outline-secondary rounded-pill">
            <i class="fas fa-arrow-left me-2"></i>Voltar ao pedido
        </a>
        <button type="button" class="btn btn-primary rounded-pill" onclick="window.print()">
            <i class="fas fa-file-pdf me-2"></i>Salvar em PDF
        </button>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-body p-4 p-lg-5">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <span class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill px-3 py-2">Comprovante</span>
                    <h2 class="fw-bold mt-3 mb-1">Pagamento do servico</h2>
                    <div class="text-muted">Numero: <strong>@Model.ReceiptNumber</strong></div>
                </div>
                <div class="text-end">
                    <div class="small text-muted">Status</div>
                    <span class="badge rounded-pill px-3 py-2 @(Model.Status == "Paid" ? "bg-success" : Model.Status == "Pending" ? "bg-warning text-dark" : Model.Status == "Refunded" ? "bg-secondary" : "bg-danger")">
                        @StatusLabel(Model.Status)
                    </span>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-6">
                    <div class="border rounded-4 p-3 h-100">
                        <h6 class="text-uppercase small text-muted mb-3">Pagador</h6>
                        <div class="fw-semibold">@Model.ClientName</div>
                        <div class="small text-muted">ID: @Model.ClientId</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="border rounded-4 p-3 h-100">
                        <h6 class="text-uppercase small text-muted mb-3">Recebedor</h6>
                        <div class="fw-semibold">@Model.ProviderName</div>
                        <div class="small text-muted">ID: @Model.ProviderId</div>
                    </div>
                </div>
            </div>

            <hr class="my-4" />

            <div class="row g-3">
                <div class="col-md-4">
                    <div class="small text-muted text-uppercase">Valor</div>
                    <div class="fs-4 fw-bold text-success">@Model.Amount.ToString("C2", ptBr)</div>
                </div>
                <div class="col-md-4">
                    <div class="small text-muted text-uppercase">Metodo</div>
                    <div class="fw-semibold">@MethodLabel(Model.Method)</div>
                </div>
                <div class="col-md-4">
                    <div class="small text-muted text-uppercase">Moeda</div>
                    <div class="fw-semibold">@Model.Currency</div>
                </div>
                <div class="col-md-6">
                    <div class="small text-muted text-uppercase">Transacao (Provider)</div>
                    <div class="fw-semibold text-break">@Model.ProviderTransactionId</div>
                </div>
                <div class="col-md-6">
                    <div class="small text-muted text-uppercase">Checkout Reference</div>
                    <div class="fw-semibold text-break">@Model.CheckoutReference</div>
                </div>
                <div class="col-md-4">
                    <div class="small text-muted text-uppercase">Criado em</div>
                    <div class="fw-semibold">@Model.CreatedAtUtc.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</div>
                </div>
                <div class="col-md-4">
                    <div class="small text-muted text-uppercase">Processado em</div>
                    <div class="fw-semibold">@(Model.ProcessedAtUtc.HasValue ? Model.ProcessedAtUtc.Value.ToLocalTime().ToString("dd/MM/yyyy HH:mm") : "-")</div>
                </div>
                <div class="col-md-4">
                    <div class="small text-muted text-uppercase">Estornado em</div>
                    <div class="fw-semibold">@(Model.RefundedAtUtc.HasValue ? Model.RefundedAtUtc.Value.ToLocalTime().ToString("dd/MM/yyyy HH:mm") : "-")</div>
                </div>
            </div>

            <div class="alert alert-light border mt-4 mb-0">
                <div class="small text-muted">
                    Este comprovante foi gerado eletronicamente em @DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss") e pode ser salvo em PDF.
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    @@media print {
        .no-print,
        nav,
        footer {
            display: none !important;
        }

        .card {
            box-shadow: none !important;
            border: 1px solid #d0d7de !important;
        }

        body {
            background: #fff !important;
        }
    }
</style>
